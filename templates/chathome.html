<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
    <title>Home | GrütteChat</title>
    <meta name="google-site-verification" content="gEiw9Swqs11DLP3QTgR8Y6hHGjQnhSWWud7LivLEmHs" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,700,0,200" />
    <link rel="stylesheet" href="https://www.gruettecloud.com/static/stylesheet.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
    <link rel="icon" href="https://www.gruettecloud.com/static/gruettechat.png">
    <script src="https://www.gruettecloud.com/static/switchservice.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        .button-chat {
            padding: 10px 20px;
            background-color: var(--background-tile-color);
            color: var(--text-color);
            border: none;
            border-radius: 5px;
            cursor: pointer;
            text-decoration: none;
            -webkit-appearance: none;
        }

        .button-chat:hover {
            background-color: var(--secondary-color);
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="dark-mode-toggle">
            <span id="darkModeToggle" class="material-symbols-outlined white-button-blue-on-hover" title="Darkmode">light_mode</span>&nbsp;&nbsp;&nbsp;&nbsp;
            {% if is_admin %}
            <span id="dashboard" style="display: inline;"><a href="/dashboard" class="white-button-blue-on-hover" title="Dashboard"><span class="material-symbols-outlined">code</span></a></span>
            {% endif %}
        </div>
        <div class="centered-content">
            <a href="/" class="logo" title="Home">
                <img src="https://www.gruettecloud.com/static/gruettechat.png" style="width: 40px; height: 40px;" title="GrütteChat">
            </a>
        </div>
        <div style="position: absolute; top: 20px; right: 0; transform: translateX(100%-20px); padding-right: 20px">
            <div class="dropdown">
                <button class="white-button-blue-on-hover" onclick="toggleDropdown()" style="background-color: var(--background-color); border: none;">
                    <span class="material-symbols-outlined" title="GrütteCloud">apps</span>
                </button>
                <div class="dropdown-menu animate__animated animate__zoomIn" style="z-index: 2; padding: 20px; text-align: center; border-radius: 20px;">
                    {% if menu %}
                        <img src="https://www.gruettecloud.com/static/profile_pictures/{{ menu["pfp"] }}" style="width: 80px; height: 80px; margin-bottom: 10px; border-radius: 50%;">
                    {% endif %}
                    <h1 style="display: flex; align-items: center; justify-content: center; font-size: 1.5em;">
                        {% if menu %}
                            Hi, {{ menu["username"] }}!
                        {% else %}
                            Hi, there!
                        {% endif %}
                    </h1>
                    {% if menu %}
                        <a href="/settings" title="Manage Account" style="background-color: var(--primary-color); border-radius: 20px; color: var(--white-color);">Manage Account</a>
                    {% else %}
                        <a href="/" title="Get Started" style="background-color: var(--primary-color); border-radius: 20px; color: var(--white-color);">Get Started</a>
                    {% endif %}
                    <hr style="display: block; border: 1px solid var(--secondary-color); border-radius: 5px; margin-top: 20px; margin-bottom: 20px;">
                    <a href="/discover" title="Discover" style="text-align: left;"><span class="material-symbols-outlined align-icons-center">explore</span>&nbsp;&nbsp;Home</a>
                    <a href="/chat" title="GrütteChat" style="text-align: left;"><span class="material-symbols-outlined align-icons-center">forum</span>&nbsp;&nbsp;GrütteChat</a>
                    <a href="/drive" title="GrütteDrive" style="text-align: left;"><span class="material-symbols-outlined align-icons-center">cloud_upload</span>&nbsp;&nbsp;GrütteDrive</a>
                    <hr style="display: block; border: 1px solid var(--secondary-color); border-radius: 5px; margin-top: 20px; margin-bottom: 20px;">
                    {% if menu %}
                        <a href="/logout" title="Logout" style="text-align: left;"><span class="material-symbols-outlined align-icons-center">logout</span>&nbsp;&nbsp;Logout</a>
                    {% else %}
                        <a href="/about" title="About" style="text-align: left;"><span class="material-symbols-outlined align-icons-center">info</span>&nbsp;&nbsp;About</a>
                        <a href="/terms" title="Terms of Service" style="text-align: left;"><span class="material-symbols-outlined align-icons-center">description</span>&nbsp;&nbsp;Terms of Service</a>
                        <a href="/privacy" title="Privacy Policy" style="text-align: left;"><span class="material-symbols-outlined align-icons-center">privacy_tip</span>&nbsp;&nbsp;Privacy Policy</a>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    {% if not has_premium %}
        <div id="premium-banner" style="display: block;">
            <button id="dismiss-button" class="button-delete" style="z-index: 1; position: absolute; top: 55px; right: 5px; height: 40px; width: 40px; display: flex; align-items: center; justify-content: center; background-color: var(--purple); color: var(--white-color); border-radius: 30px;">
                <span class="material-symbols-outlined">close</span>
            </button>
            <a href="/premium" style="text-decoration: none; color: var(--white-color);">
                <div class="wrapping-tile" style="text-align: center; background-color: var(--purple); padding: 20px; border-radius: 30px;">
                    <h1>Unlock GrütteCloud PLUS</h1>
                    only 2.99 € once!
                    <!-- It's free! -->
                </div>
            </a>
            <div class="spaced-tile"></div>
        </div>
    {% endif %}

    {% if status_message %}
        <div class="wrapping-tile" style="text-align: center; padding: 20px; border-radius: 30px;">
            <h2 style="color: var(--{{ status_message["color"] }});">{{ status_message["subject"] }}</h2>
            <p style="color: var(--{{ status_message["color"] }});">{{ status_message["content"] }}</p>
        </div>
        <div class="spaced-tile"></div>
    {% endif %}

    <!-- center vertically -->
    <div class="animate__animated animate__zoomIn" id="searchFormDiv" style="display: none;">
        <form method="POST">
            <input id="searchFormInput" class="message-input" type="text" name="recipient" placeholder="Search username" autocomplete="off" style="font-size: 1em; width: 100%; padding-left: 20px; height: 55px; background-color: var(--background-tile-color); border-style: solid; border-color: transparent; border-radius: 30px; border-width: 2px; margin-right: 0; box-shadow: 6px 6px 12px rgba(0, 0, 0, 0.4);">
            <div id="email-tag" style="width: 47px; height: 25px; display: none; position: absolute; left: 20px; top: 15px; border-radius: 10px; color: var(--text-color); font-size: 0.8em; background-color: var(--secondary-color); justify-content: center; align-items: center;">
            email
            </div>
            
            <button name="send" class="send-button" style="width: 40px; height: 40px; position: absolute; right: 53px; border-radius: 20px; margin: 0; padding: 5px; text-align: center; display: flex; align-items: center; justify-content: center;">
                <span class="material-symbols-outlined">search</span>
            </button>
            <div id="close" class="send-button" style="width: 40px; height: 40px; position: absolute; right: 8px; border-radius: 20px; margin: 0; padding: 5px; text-align: center; display: flex; align-items: center; justify-content: center; background-color: var(--red);">
                <span class="material-symbols-outlined">close</span>
            </div>
            <!--<input type="text" id="recipient" name="recipient" placeholder="Start a new chat" autocomplete="off" style="width: calc(100% - 140px);">
            <input type="submit" name="new" value="Start Chat" class="send-button">-->
        </form>
        <div id="matching-usernames" class="wrapping-tile" style="display: none; padding-bottom: 5px; border-radius: 30px; margin-top: 20px;">
        </div>
    </div>

    {% if error %}
        <div id="error-message" style="display: none;">
            <div class="spaced-tile"></div>
            <div class="wrapping-tile" style="text-align: center; border-radius: 30px;">
                <div class="inner-tile">
                    <div class="spaced-tile"></div>
                        <h2 style="color: var(--yellow)">{{ error }}</h2>
                    <div class="spaced-tile"></div>
                </div>
            </div>
        </div>
    {% endif %}

    <div class="spaced-tile"></div>
    <div style="flex-direction: row; display: flex; width: 100%;">
        <div class="wrapping-tile" style="padding-bottom: 5px; border-radius: 30px;">
            <div style="display: flex; align-items: center;">
                <div style="flex-grow: 1;">
                    <h1 style="margin: 10px; text-align: center; display: flex; align-items: center; justify-content: center;">
                        Welcome, {{ username }}{% if verified %}<span class="material-symbols-outlined" style="margin-left: 5px; color: var(--primary-color); align-self: center;">verified</span>{% endif %}
                    </h1>
                </div>
            </div>
            <div id="showSearchButton" style="background-color: var(--background-color); z-index: 1;">
                <div style="width: 40px; height: 40px; position: absolute; right: 52px; margin-top: -47px; border-radius: 20px; text-align: center; display: flex; align-items: center; justify-content: center; cursor: pointer;">
                    <span class="material-symbols-outlined" title="Search">search</span>
                </div>
            </div>

            <div class="spaced-tile"></div>

            <hr style="border: 1px solid var(--box-shadow-color); border-radius: 5px; margin-left: 25px; margin-right: 25px;">
            <div style="display: flex; align-items: center; margin-bottom: 5px; margin-top: 5px;">
                <a href="/ai/chat" style="color: var(--text-color); text-decoration: none; display: flex; align-items: center; flex: 1;">
                    <button class="button-chat text-offcutter" style="width: 100%; display: flex; align-items: center; color: var(--text-color); font-size: 1.2em; border-radius: 30px;">
                        <img src="https://www.gruettecloud.com/static/profile_pictures/ai.png" style="height: 40px; width: 40px; border-radius: 50%; margin-left: 10px; margin-right: 10px;">
                        <span style="margin-left: -20px; margin-top: -30px; background-color: var(--red); border-radius: 50%; width 20px; height: 20px; font-size: 0.6em; display: flex; align-items: center; justify-content: center; color: var(--white-color); padding: 3px;">&nbsp;1&nbsp;</span>
                        <span class="text-offcutter" style="margin-left: 5px;">MyAI</span>
                        <a title="MyAI" style="text-decoration: none; color: var(--text-color);"><span class="material-symbols-outlined" style="margin-right: 10px; display: flex; align-items: center; justify-content: center;">smart_toy</span></a>
                    </button>
                </a>
            </div>

            {% if not active_chats %}
                    <hr style="border: 1px solid var(--box-shadow-color); border-radius: 5px; margin-left: 25px; margin-right: 25px;">
                    <p style="margin-left: 30px; margin-top: 10px; margin-bottom: 10px;">Suggestions:</p>
                {% for chat in suggested %}
                <hr style="border: 1px solid var(--box-shadow-color); border-radius: 5px; margin-left: 25px; margin-right: 25px;">
                    <div style="display: flex; align-items: center; margin-bottom: 5px; margin-top: 5px;">
                        <a href="/chat/{{ chat['username'] }}" style="color: var(--text-color); text-decoration: none; display: flex; align-items: center; flex: 1;">
                            <button class="button-chat text-offcutter" style="width: 100%; display: flex; align-items: center; color: var(--text-color); font-size: 1.2em; border-radius: 30px;">
                                <img src="https://www.gruettecloud.com/static/profile_pictures/{{ chat['pfp'] }}" style="height: 40px; width: 40px; border-radius: 50%; margin-left: 10px; margin-right: 10px;">
                                <span class="text-offcutter" style="margin-left: 5px;">{{ chat['username'] }}</span>
                                {% if suggested['is_verified'] %}<span class="material-symbols-outlined" style="margin-left: 5px; color: var(--primary-color); align-self: center;">verified</span>{% endif %}
                                <a href="/chat/delete/{{ chat['username'] }}" class="logout" title="Delete chat" style="text-decoration: none;"><span class="material-symbols-outlined" style="margin-right: 10px; display: flex; align-items: center; justify-content: center;">delete</span></a>
                            </button>
                        </a>
                    </div>
                {% endfor %}
            {% endif %}

            {% for chat in active_chats %}
                <hr style="border: 1px solid var(--box-shadow-color); border-radius: 5px; margin-left: 25px; margin-right: 25px;">
                <div style="display: flex; align-items: center; margin-bottom: 5px; margin-top: 5px;">
                    <a href="/chat/{{ chat['username'] }}" style="color: var(--text-color); text-decoration: none; display: flex; align-items: center; flex: 1;">
                        <button class="button-chat text-offcutter" style="width: 100%; display: flex; align-items: center; color: var(--text-color); font-size: 1.2em; border-radius: 30px;">
                            <img src="https://www.gruettecloud.com/static/profile_pictures/{{ chat['pfp'] }}" style="height: 40px; width: 40px; border-radius: 50%; margin-left: 10px; margin-right: 10px;">
                            <span class="text-offcutter" style="margin-left: 5px;">{{ chat['username'] }}</span>
                            {% if chat['is_verified'] %}<span class="material-symbols-outlined" style="margin-left: 5px; color: var(--primary-color); align-self: center;">verified</span>{% endif %}
                            <a href="/chat/delete/{{ chat['username'] }}" class="logout" title="Delete chat" style="text-decoration: none;"><span class="material-symbols-outlined" style="margin-right: 10px; display: flex; align-items: center; justify-content: center;">delete</span></a>
                        </button>
                    </a>
                </div>
            {% endfor %}
        </div>

    </div>
    <div class="spaced-tile"></div>
    <div id="cookie-banner"></div>
    <div style="display: flex; justify-content: center; padding: 20px; box-sizing: border-box; margin-top: auto;">
        <div style="display: flex;">
            <div style="width: 50%; margin-right: 20px; text-align: left;">
                <b style="font-size: 0.9em;">GrütteCloud</b>
                <div style="white-space: nowrap; line-height: 1em;">
                    <a class="footer-link" href="/help">Help Center</a><br>
                    <a class="footer-link" href="/discover">What is GrütteCloud?</a><br>
                    <a class="footer-link" href="/support">Contact Support</a>
                </div>
            </div>
            <div style="width: 50%; text-align: left;">
                <b style="font-size: 0.9em;">Legal</b>
                <div style="white-space: nowrap; line-height: 1em;">
                    <a class="footer-link" href="about">Über Uns</a><br>
                    <a class="footer-link" href="/terms">Terms of Service</a><br>
                    <a class="footer-link" href="/privacy">Privacy Policy</a>
                </div>
            </div>
        </div>
    </div>
</body>
</html>

<script>
    // Dark mode toggle functionality
    var darkModeToggle = document.getElementById('darkModeToggle');
    var body = document.body;
    var isDarkMode = localStorage.getItem('darkMode');

    if (isDarkMode === 'true') {
        body.classList.add('dark-mode');
        document.documentElement.setAttribute('data-theme', 'dark');
        darkModeToggle.innerHTML = 'dark_mode'; // Change the inner HTML to the dark mode icon
    }

    darkModeToggle.addEventListener('click', function() {
        if (body.classList.contains('dark-mode')) {
            body.classList.remove('dark-mode');
            localStorage.setItem('darkMode', 'false');
            document.documentElement.setAttribute('data-theme', 'light');
            darkModeToggle.innerHTML = 'light_mode'; // Change the inner HTML to the light mode icon
        } else {
            body.classList.add('dark-mode');
            localStorage.setItem('darkMode', 'true');
            document.documentElement.setAttribute('data-theme', 'dark');
            darkModeToggle.innerHTML = 'dark_mode'; // Change the inner HTML to the dark mode icon
        }
    });

    darkModeToggle.style.cursor = 'pointer'; // Add this line to change the cursor to a pointer on hover

    {% if not has_premium %}
    // GrütteCloud PLUS banner functionality
    document.addEventListener('DOMContentLoaded', function () {
        const banner = document.getElementById('premium-banner');
        const dismissButton = document.getElementById('dismiss-button');

        // Check if the cookie 'premiumBannerDismissed' exists
        const cookieExists = document.cookie.indexOf('premiumBannerDismissed=true') !== -1;

        if (cookieExists) {
            banner.style.display = 'none';
        } else {
            banner.style.display = 'block';
        }

        // Set the cookie and hide the banner when the 'Dismiss' button is clicked
        dismissButton.addEventListener('click', function () {
            // Set the cookie to expire in 7 days
            const expirationDate = new Date();
            expirationDate.setDate(expirationDate.getDate() + 7);
            document.cookie = 'premiumBannerDismissed=true; expires=' + expirationDate.toUTCString();

            // Hide the banner
            banner.style.display = 'none';
        });
    });
    {% endif %}
</script>

<script>
    // Show error message and fade out after 5 seconds
    var errorMessage = document.getElementById('error-message');
    {% if error %}
        errorMessage.style.display = 'block';
        setTimeout(function() {
            errorMessage.style.opacity = '0';
            setTimeout(function() {
                errorMessage.style.display = 'none';
                errorMessage.style.opacity = '1';
            }, 500);
        }, 5000);
    {% endif %}
</script>

<script>
    const searchForm = document.getElementById('searchFormDiv');
    const showSearch = document.getElementById('showSearchButton');
    const closeSearch = document.getElementById('close');

    showSearch.addEventListener('click', function() {
        searchForm.classList.remove('animate__zoomOut');
        searchForm.classList.add('animate__animated', 'animate__zoomIn');
        searchForm.style.display = 'block';
        showSearch.style.display = 'none';
    });

    closeSearch.addEventListener('click', function() {
        searchForm.classList.remove('animate__zoomIn');
        searchForm.classList.add('animate__animated', 'animate__zoomOut');
        setTimeout(function() {
            searchForm.style.display = 'none';
            showSearch.style.display = 'block';
        }, 500);
    });


    {% if not active_chats %}
        searchForm.style.display = 'block';
        showSearch.style.display = 'none';
    {% endif %}
</script>

<script>
    $(document).ready(function() {
        // Define a variable to hold the timer ID
        let debounceTimer;
    
        // Function to send AJAX request and update results
        function updateSearchResults() {
            var inputUsername = $('#searchFormInput').val();
            var inputElement = $('#searchFormInput');
            $('#email-tag').css("display", "none");
            if (inputUsername.length < 1) {
                $('#matching-usernames').css("display", "none");
                return;
            }
    
            // Clear any existing timer
            clearTimeout(debounceTimer);
    
            /// Set a new timer to trigger the search after 1000ms (1 second)
            debounceTimer = setTimeout(function() {
                // Check if the input starts with "email:"
                if (inputUsername.startsWith("email:")) {
                    // Add a single space if it's not already there
                    if (!inputUsername.startsWith("email: ")) {
                        inputUsername = "email: " + inputUsername.substring("email:".length);
                        inputElement.val(inputUsername);
                    }
                    // Show the email tag
                    $('#email-tag').css("display", "flex");
                } else {
                    // Hide the email tag
                    $('#email-tag').css("display", "none");
                }

                // Continue with the AJAX request and other code
                $.ajax({
                    url: '/search_username/' + inputUsername,
                    type: 'GET',
                        success: function(data) {
                            $('#matching-usernames').empty();
                            $('#matching-usernames').css("display", "block");
                            const headingElement = document.createElement("p");
                            headingElement.style.marginLeft = "25px";
                            headingElement.style.marginBottom = "10px";
                            headingElement.style.marginTop = "10px";
                            headingElement.textContent = "Search results:";
                            $('#matching-usernames').append(headingElement);
        
                            if (data.users.length == 0) {
                                $('#matching-usernames').empty();
                                const noResultsElement = document.createElement("p");
                                noResultsElement.style.marginLeft = "25px";
                                noResultsElement.style.marginBottom = "10px";
                                noResultsElement.style.marginTop = "10px";
                                noResultsElement.textContent = "No users found.";
                                $('#matching-usernames').append(noResultsElement);
                            }

                            if (data.users.length > 5) {
                                data.users = data.users.slice(0, 5);
                            }
        
                            for (let i = 0; i < data.users.length; i++) {
                                const chat = data.users[i];
                                const username = chat.username;
                                const profile_picture = "https://www.gruettecloud.com/static/profile_pictures/" + chat.profile_picture + ".png";
                    
                                // Create the HTML elements
                                const hrElement = document.createElement("hr");
                                hrElement.style.border = "1px solid var(--box-shadow-color)";
                                hrElement.style.borderRadius = "5px";
                                hrElement.style.marginLeft = "25px";
                                hrElement.style.marginRight = "25px";
                    
                                const divElement = document.createElement("div");
                                divElement.style.display = "flex";
                                divElement.style.alignItems = "center";
                                divElement.style.marginBottom = "5px";
                                divElement.style.marginTop = "5px";
                    
                                const aElement = document.createElement("a");
                                aElement.href = "/chat/" + username;
                                aElement.style.color = "var(--text-color)";
                                aElement.style.textDecoration = "none";
                                aElement.style.display = "flex";
                                aElement.style.alignItems = "center";
                                aElement.style.flex = "1";
                    
                                const buttonElement = document.createElement("button");
                                buttonElement.className = "button-chat text-offcutter";
                                buttonElement.style.width = "100%";
                                buttonElement.style.display = "flex";
                                buttonElement.style.alignItems = "center";
                                buttonElement.style.color = "var(--text-color)";
                                buttonElement.style.fontSize = "1.2em";
                                buttonElement.style.borderRadius = "30px";
                    
                                const imgElement = document.createElement("img");
                                imgElement.src = profile_picture;
                                imgElement.style.height = "40px";
                                imgElement.style.width = "40px";
                                imgElement.style.borderRadius = "50%";
                                imgElement.style.marginLeft = "10px";
                                imgElement.style.marginRight = "10px";
                    
                                const spanElement = document.createElement("span");
                                spanElement.className = "text-offcutter";
                                spanElement.style.marginLeft = "5px";
                                spanElement.textContent = username;
                    
                                // Append the elements
                                aElement.appendChild(buttonElement);
                                buttonElement.appendChild(imgElement);
                                buttonElement.appendChild(spanElement);
                    
                                // Check for 'is_verified' and add the corresponding span
                                if (chat.is_verified) {
                                    const verifiedSpan = document.createElement("span");
                                    verifiedSpan.className = "material-symbols-outlined";
                                    verifiedSpan.style.marginLeft = "5px";
                                    verifiedSpan.style.color = "var(--primary-color)";
                                    verifiedSpan.style.alignSelf = "center";
                                    verifiedSpan.textContent = "verified";
                                    buttonElement.appendChild(verifiedSpan);
                                }
                
                                aElement.appendChild(buttonElement);
                                divElement.appendChild(aElement);
                                $('#matching-usernames').append(hrElement);
                                $('#matching-usernames').append(divElement);
                            }
                        }
                });
            }, 1000); // Delay the search by 1 second
        }
    
        // Trigger the search when the input field changes
        $('#searchFormInput').on('input', function() {
            clearTimeout(debounceTimer); // Clear any existing timer
            debounceTimer = setTimeout(updateSearchResults, 1000); // Set a new timer to trigger the search
        });
    });    
</script>


<script src="https://www.gruettecloud.com/static/cookies.js"></script>