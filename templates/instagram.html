<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
    <title>Instagram | GrütteCloud</title>
    <meta name="google-site-verification" content="gEiw9Swqs11DLP3QTgR8Y6hHGjQnhSWWud7LivLEmHs" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,400,0,0" />
    <link rel="stylesheet" href="/static/stylesheet.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
    <link rel="icon" href="https://www.gruettecloud.com/static/gruettechat.png">
    <style>
        .centered-div {
            max-width: 90vw;

        }

        .resize-logo {
            width: 6em;
            height: auto;
        }

        h2 {
            font-size: 1.2em;
        }

        p {
            font-size: 0.8em;
        }

        @media (min-width: 768px) {
            .wrapping-tile {
                max-width: 400px;
            }

            .resize-logo {
                width: 8em;
                height: auto;
            }

            h2 {
                font-size: 1.5em;
            }
    
            p {
                font-size: 0.9em;
            }
        }

        ::-webkit-scrollbar {
            display: none;
        }
        
        
        ::-webkit-scrollbar-track {
            display: none;
            
        }
        
        ::-webkit-scrollbar-thumb {
            display: none;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="dark-mode-toggle">
            <a href="/" class="white-button-blue-on-hover" title=""><span class="material-symbols-rounded">arrow_back_ios_new</span></a>&nbsp;&nbsp;&nbsp;&nbsp;
            <span id="darkModeToggle" class="material-symbols-rounded white-button-blue-on-hover" title="Darkmode">sunny</span>
        </div>
		<div class="centered-content">
            <a href="/" class="logo" title="Home">
                <img src="https://www.gruettecloud.com/static/gruettecloud_logo.png" style="width: 40px; height: 40px;" title="GrütteCloud">
            </a>
        </div>
		{% include "components/nav-element.html" %}
	</div>

    <div style="width: 100%; height: 100%; display: flex; gap: 20px; max-height: calc(100% - 0px); overflow-y: auto; justify-content: center; align-items: center;">
        <div style="width: 300px; height: 100%; background-color: var(--background-tile-color); padding: 20px; border-radius: 20px; gap: 20px; display: flex; flex-direction: column; justify-content: space-between;">
            
            <span style="display: flex; justify-content: center; align-items: center; gap: 20px; flex-direction: column;">
                <span style="width: 100%; display: flex; text-align: center; justify-content: center; align-items: center; gap: 10px; margin-bottom: 15px;">
                    <img width="20px" height="auto" src="https://cdn.simpleicons.org/instagram" alt="Instagram">
                    <span style="font-size: 1em;">Instagram Analytics</span>
                </span>

                <span id="followers-completed" style="width: 100%; display: {% if files["followers"]["filename"] != None %}flex;{% else %}none;{% endif%} text-align: center; justify-content: start; align-items: center; gap: 10px;">
                    <span class="material-symbols-rounded" style="font-size: 1.5em; color: var(--green);">check_circle</span>
                    followers.html
                </span>
                
                <span id="followers-file" style="display: {% if files["followers"]["filename"] != None %}none;{% else %}flex;{% endif%} width: 100%; justify-content: start; align-items: center; gap: 10px;">
                    <input type="file" name="followers" id="followers" accept=".html" style="display: none;">
                    <label for="followers" style="cursor: pointer; width: 100%; display: flex; justify-content: start; align-items: center; gap: 10px;">
                        <span class="material-symbols-rounded">add</span>
                        Upload followers.html
                    </label>
                </span>

                <span id="following-completed" style="width: 100%; display: {% if files["following"]["filename"] != None %}flex;{% else %}none;{% endif%} text-align: center; justify-content: start; align-items: center; gap: 10px;">
                    <span class="material-symbols-rounded" style="font-size: 1.5em; color: var(--green);">check_circle</span>
                    following.html
                </span>

                <span id="following-file" style="display: {% if files["following"]["filename"] != None %}none;{% else %}flex;{% endif%} width: 100%; justify-content: start; align-items: center; gap: 10px;">
                    <input type="file" name="following" id="following" accept=".html" style="display: none;">
                    <label for="following" style="cursor: pointer; width: 100%; display: flex; justify-content: start; align-items: center; gap: 10px;">
                        <span class="material-symbols-rounded">add</span>
                        Upload following.html
                    </label>
                </span>
            </span>

            <span style="display: flex; justify-content: center; align-items: center; gap: 20px; flex-direction: column;">
                <form action="/instagram" method="post">
                    <input type="hidden" name="delete" value="true">
                    <button id="delete-files-button" type="submit" style="width: 100%; display: {% if files["followers"]["filename"] == None and files["following"]["filename"] == None %}none;{% else %}flex;{% endif%} justify-content: center; align-items: center; gap: 10px; background-color: var(--red); color: white; border: none; padding: 10px 20px; border-radius: 10px; cursor: pointer;">
                        <span class="material-symbols-rounded">delete</span>
                        Delete files
                    </button>
                </form>
            </span>
        </div>
        <div style="width: 100%; height: 100%; background-color: var(--background-tile-color); padding: 20px; border-radius: 20px; max-height: calc(100% - 0px); overflow-y: auto;">
            <!-- no scrollbar -->
            <span id="results" style"scroll-behavior: smooth; display: flex; justify-content: center; align-items: center; flex-direction: column;"></span>
            <div id="start-and-hint-area" style="display: flex; justify-content: center; align-items: center; gap: 20px; flex-direction: column; height: 100%;">
                <span id="start-and-hint-area-start" style="display: {% if files["followers"]["filename"] == None and files["following"]["filename"] == None %}none;{% else %}flex;{% endif%} justify-content: center; align-items: center; gap: 20px; flex-direction: column;">
                    <span class="material-symbols-rounded" style="font-size: 2em; background-color: var(--primary-color); color: white; display: flex; justify-content: center; align-items: center; border-radius: 50%; padding: 10px; cursor: pointer;" onclick="analyzeData();">play_arrow</span>
                    <h2>Start analysis</h2>
                </span>
                <p id="start-and-hint-area-upload" style="display: {% if files["followers"]["filename"] == None and files["following"]["filename"] == None %}flex;{% else %}none;{% endif%} justify-content: center; align-items: center; gap: 20px; flex-direction: column;">
                    Upload your followers.html and following.html files to start the analysis.
                </p>
            </div>
        </div>
    </div>
    

    <div id="cookie-banner"></div>
</body>
</html>

<script>    
    document.getElementById("followers").addEventListener("change", function() {
        // post request to upload followers.html
        var form = new FormData();
        form.append("followers", this.files[0]);

        fetch("/instagram", {
            method: "POST",
            body: form
        })
        .then(response => response.json())
        .then(data => {
            if (data["success"]) {
                document.getElementById("followers-completed").style.display = "flex";
                document.getElementById("followers-file").style.display = "none";
                document.getElementById("delete-files-button").style.display = "flex";

                if (document.getElementById("following-completed").style.display == "flex") {
                    document.getElementById("start-and-hint-area-start").style.display = "flex";
                    document.getElementById("start-and-hint-area-upload").style.display = "none";
                }
            }
        });
    });

    document.getElementById("following").addEventListener("change", function() {
        // post request to upload following.html
        var form = new FormData();
        form.append("following", this.files[0]);

        fetch("/instagram", {
            method: "POST",
            body: form
        })
        .then(response => response.json())
        .then(data => {
            if (data["success"]) {
                document.getElementById("following-completed").style.display = "flex";
                document.getElementById("following-file").style.display = "none";
                document.getElementById("delete-files-button").style.display = "flex";

                if (document.getElementById("followers-completed").style.display == "flex") {
                    document.getElementById("start-and-hint-area-start").style.display = "flex";
                    document.getElementById("start-and-hint-area-upload").style.display = "none";
                }
            }
        });
    });

    function analyzeData() {
        var form = new FormData();
        form.append("analyze", true);
        
        fetch("/instagram", {
            method: "POST",
            body: form
        })
        .then(response => response.json())
        .then(data => {
            if (data["success"]) {
                document.getElementById("start-and-hint-area-start").style.display = "none";
                document.getElementById("start-and-hint-area-upload").style.display = "none";
                document.getElementById("start-and-hint-area").style.display = "none";

                
                for (var i = 0; i < data["not_following_back"].length; i++) {
                    var notFollowingBack = data["not_following_back"][i];
                    var notFollowingBackElement = document.createElement("a");
                    notFollowingBackElement.href = "https://www.instagram.com/" + notFollowingBack;
                    notFollowingBackElement.target = "_blank";
                    notFollowingBackElement.style = "display: flex; justify-content: space-between; align-items: center; gap: 20px; padding: 5px; text-decoration: none; color: var(--text-color);";
                    notFollowingBackElement.innerHTML = notFollowingBack;
                    document.getElementById("results").appendChild(notFollowingBackElement);
                }

            }
        });
    }
</script>

<script src="https://www.gruettecloud.com/static/cookies.js"></script>
<script src="https://www.gruettecloud.com/static/darkmode.js"></script>